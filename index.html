<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <title>OPR SJKC KM1 - AUTO-SAVE</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f8f9fa; padding: 20px; font-family: Arial, sans-serif; }
        .container { max-width: 900px; background: white; padding: 30px; border-radius: 15px; box-shadow: 0 5px 20px rgba(0,0,0,0.1); }
        #report-preview { display: none; margin-top: 20px; border: 1px solid #ddd; padding: 10px; }

        @media print {
            .no-print { display: none !important; }
            #report-preview { display: block !important; border: none; padding: 0; }
            body { background: white; padding: 0; }
            @page { size: A4; margin: 1cm; }
            * { -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; }
            
            .report-page { width: 100%; border: none; }
            table { width: 100%; border-collapse: collapse; margin-bottom: 15px; }
            th, td { border: 1px solid black !important; padding: 8px; font-size: 10pt; }
            th { background-color: #f2f2f2 !important; }
            
            .grid-gambar { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin: 10px 0; }
            .img-box { height: 200px; border: 1px solid black; display: flex; align-items: center; justify-content: center; }
            .img-box img { max-height: 100%; max-width: 100%; object-fit: contain; }
        }
    </style>
</head>
<body>

<div class="container no-print">
    <div class="alert alert-info"><strong>Info:</strong> Maklumat anda disimpan automatik. Anda tak perlu taip semula jika page ini ditutup.</div>
    <h3 class="fw-bold text-center mb-4">PENJANA OPR SJKC KM1</h3>

    <form id="oprForm">
        <div class="row g-2">
            <div class="col-12"><label class="small fw-bold">NAMA PROGRAM</label><input type="text" id="i1" class="form-control" oninput="save()"></div>
            <div class="col-md-6"><label class="small fw-bold">ANJURAN</label><input type="text" id="i2" class="form-control" oninput="save()"></div>
            <div class="col-md-3"><label class="small fw-bold">TARIKH</label><input type="date" id="i3" class="form-control" oninput="save()"></div>
            <div class="col-md-3"><label class="small fw-bold">MASA</label><input type="text" id="i4" class="form-control" oninput="save()"></div>
            <div class="col-md-6"><label class="small fw-bold">TEMPAT</label><input type="text" id="i5" class="form-control" oninput="save()"></div>
            <div class="col-md-6"><label class="small fw-bold">SASARAN</label><input type="text" id="i6" class="form-control" oninput="save()"></div>
            <div class="col-12"><label class="small fw-bold">OBJEKTIF</label><textarea id="i7" class="form-control" rows="2" oninput="save()"></textarea></div>
            <div class="col-12"><label class="small fw-bold">AKTIVITI</label><textarea id="i8" class="form-control" rows="2" oninput="save()"></textarea></div>
            <div class="col-md-6"><label class="small fw-bold">KEKUATAN</label><textarea id="i9" class="form-control" rows="2" oninput="save()"></textarea></div>
            <div class="col-md-6"><label class="small fw-bold">KELEMAHAN</label><textarea id="i10" class="form-control" rows="2" oninput="save()"></textarea></div>
            <div class="col-md-6"><label class="small fw-bold">DISEDIAKAN OLEH</label><input type="text" id="i11" class="form-control" oninput="save()"></div>
            <div class="col-md-6"><label class="small fw-bold">DISAHKAN OLEH</label><input type="text" id="i12" class="form-control" oninput="save()"></div>
            <div class="col-12"><label class="small fw-bold text-danger">GAMBAR AKTIVITI (1-4)</label><input type="file" id="iImg" class="form-control border-danger" multiple accept="image/*"></div>
        </div>
        
        <button type="button" onclick="janaDanCetak()" class="btn btn-primary w-100 mt-4 fw-bold p-3">PAPAR & CETAK PDF</button>
        <button type="button" onclick="clearData()" class="btn btn-link w-100 mt-2 text-muted small">Padam Semua & Mula Baru</button>
    </form>
</div>

<div id="report-preview">
    <div class="report-page">
        <table style="border:none !important;">
            <tr style="border:none !important;">
                <td style="width:15%; border:none !important;"><img src="https://i.postimg.cc/PJwfS3KM/Jata-Malaysia-V2-svg.png" width="60"></td>
                <td style="text-align:center; border:none !important;">
                    <div style="font-weight:bold; font-size:12pt;">LAPORAN ONE PAGE REPORT (OPR)</div>
                    <div style="font-weight:bold; font-size:12pt;">SJKC KONG MIN CAWANGAN SATU</div>
                </td>
                <td style="width:15%; border:none !important; text-align:right;"><img src="https://i.postimg.cc/fR4SQX9P/SJKC-KONG-MIN-CAWANGAN-SATU.png" width="60"></td>
            </tr>
        </table>

        <table>
            <tr><th style="width:20%">Program</th><td colspan="3" id="o1" style="font-weight:bold; text-transform:uppercase;"></td></tr>
            <tr><th>Anjuran</th><td id="o2"></td><th style="width:20%">Tarikh / Masa</th><td id="o34"></td></tr>
            <tr><th>Tempat</th><td id="o5"></td><th>Sasaran</th><td id="o6"></td></tr>
            <tr><th>Objektif</th><td colspan="3" id="o7"></td></tr>
            <tr><th>Aktiviti</th><td colspan="3" id="o8"></td></tr>
            <tr><th>Kekuatan</th><td colspan="3" id="o9"></td></tr>
            <tr><th>Kelemahan</th><td colspan="3" id="o10"></td></tr>
        </table>

        <div class="grid-gambar" id="oImg"></div>

        <div style="display:flex; justify-content:space-between; margin-top:20px;">
            <div style="width:40%">Disediakan oleh:<br><br><br>____________________<br>(<span id="o11"></span>)</div>
            <div style="width:40%; text-align:right;">Disahkan oleh:<br><br><br>____________________<br>(<span id="o12"></span>)</div>
        </div>
    </div>
</div>

<script>
    // AUTO-SAVE: Simpan data dalam browser
    function save() {
        for(let i=1; i<=12; i++) {
            localStorage.setItem('opr_i'+i, document.getElementById('i'+i).value);
        }
    }

    // LOAD DATA: Ambil semula data masa page dibuka
    window.onload = function() {
        for(let i=1; i<=12; i++) {
            if(localStorage.getItem('opr_i'+i)) {
                document.getElementById('i'+i).value = localStorage.getItem('opr_i'+i);
            }
        }
    };

    function clearData() {
        if(confirm("Padam semua data?")) {
            localStorage.clear();
            location.reload();
        }
    }

    function janaDanCetak() {
        // Pindahkan data ke template
        for(let i=1; i<=12; i++) {
            let val = document.getElementById('i'+i).value;
            if(i === 3) {
                document.getElementById('o34').innerText = val + " / " + document.getElementById('i4').value;
            } else if(i !== 4) {
                if(document.getElementById('o'+i)) document.getElementById('o'+i).innerText = val;
            }
        }

        const outImg = document.getElementById('oImg');
        outImg.innerHTML = '';
        const files = Array.from(document.getElementById('iImg').files).slice(0, 4);
        
        if (files.length > 0) {
            let loaded = 0;
            files.forEach(file => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    outImg.innerHTML += `<div class="img-box"><img src="${e.target.result}"></div>`;
                    loaded++;
                    if(loaded === files.length) {
                        document.getElementById('report-preview').style.display = 'block';
                        setTimeout(() => { window.print(); }, 500);
                    }
                };
                reader.readAsDataURL(file);
            });
        } else {
            document.getElementById('report-preview').style.display = 'block';
            window.print();
        }
    }
</script>
</body>
</html>
