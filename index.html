<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <title>OPR SJKC KM1 - Versi Gambar Stabil</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        /* Gaya paparan di skrin */
        body { background-color: #f0f2f5; padding: 20px; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .container { max-width: 900px; background: white; padding: 30px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        .preview-box { border: 2px dashed #ccc; padding: 10px; margin-top: 20px; background: #fff; display: none; }
        
        /* GAYA KHAS UNTUK CETAK (PDF) */
        @media print {
            .no-print { display: none !important; }
            .preview-box { display: block !important; border: none; padding: 0; margin: 0; }
            body { background: white; padding: 0; margin: 0; }
            @page { size: A4; margin: 10mm; }
            
            /* Paksa gambar dan warna muncul */
            * { -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; }
            
            .report-page { width: 100%; display: flex; flex-direction: column; color: black; }
            table { width: 100%; border-collapse: collapse; margin-bottom: 15px; }
            th, td { border: 1.5px solid black !important; padding: 8px 12px; font-size: 10.5pt; vertical-align: top; }
            th { background-color: #f2f2f2 !important; font-weight: bold; width: 25%; }
            
            .grid-gambar { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin: 15px 0; }
            .img-box { height: 200px; border: 1px solid black; display: flex; align-items: center; justify-content: center; }
            .img-box img { max-height: 100%; max-width: 100%; object-fit: contain; display: block; }
            
            .footer-sig { display: flex; justify-content: space-between; margin-top: auto; padding-top: 30px; }
            .sig-box { width: 45%; }
            .sig-line { border-bottom: 1.5px solid black; display: block; height: 50px; margin-bottom: 5px; }
        }
    </style>
</head>
<body>

<div class="container no-print">
    <div class="text-center mb-4">
        <h2 class="fw-bold text-dark">PENJANA OPR SJKC KM1</h2>
        <p class="badge bg-danger">Sila pastikan "Background Graphics" dihidupkan semasa menyimpan PDF</p>
    </div>

    <form id="mainForm">
        <div class="row g-3">
            <div class="col-12"><label class="fw-bold">NAMA PROGRAM</label><input type="text" id="in1" class="form-control" placeholder="Contoh: RMT HARI PERTAMA 2026"></div>
            <div class="col-md-6"><label class="fw-bold">ANJURAN</label><input type="text" id="in2" class="form-control"></div>
            <div class="col-md-3"><label class="fw-bold">TARIKH</label><input type="date" id="in3" class="form-control"></div>
            <div class="col-md-3"><label class="fw-bold">MASA</label><input type="text" id="in4" class="form-control" placeholder="Contoh: 10:10 - 10:30 PAGI"></div>
            <div class="col-md-6"><label class="fw-bold">TEMPAT</label><input type="text" id="in5" class="form-control"></div>
            <div class="col-md-6"><label class="fw-bold">SASARAN</label><input type="text" id="in6" class="form-control"></div>
            <div class="col-12"><label class="fw-bold">OBJEKTIF</label><textarea id="in7" class="form-control" rows="2"></textarea></div>
            <div class="col-12"><label class="fw-bold">AKTIVITI</label><textarea id="in8" class="form-control" rows="2"></textarea></div>
            <div class="col-md-6"><label class="fw-bold">KEKUATAN</label><textarea id="in9" class="form-control" rows="2"></textarea></div>
            <div class="col-md-6"><label class="fw-bold">KELEMAHAN</label><textarea id="in10" class="form-control" rows="2"></textarea></div>
            <div class="col-md-6"><label class="fw-bold">DISEDIAKAN OLEH</label><input type="text" id="in11" class="form-control" placeholder="Nama & Jawatan"></div>
            <div class="col-md-6"><label class="fw-bold">DISAHKAN OLEH</label><input type="text" id="in12" class="form-control" placeholder="Nama & Jawatan"></div>
            <div class="col-12">
                <label class="fw-bold text-primary">MUAT NAIK GAMBAR AKTIVITI (1-4 Keping)</label>
                <input type="file" id="inImg" class="form-control border-primary" multiple accept="image/*">
            </div>
        </div>
        
        <div class="mt-4 d-flex gap-2">
            <button type="button" onclick="janaPreview()" class="btn btn-secondary w-50 fw-bold">1. PAPAR PREVIEW</button>
            <button type="button" onclick="cetakPDF()" id="btnPrint" class="btn btn-primary w-50 fw-bold" disabled>2. CETAK / SIMPAN PDF</button>
        </div>
    </form>
</div>

<div id="report-preview" class="preview-box">
    <div class="report-page">
        <table style="border: none !important; margin-bottom: 20px;">
            <tr style="border: none !important;">
                <td style="width: 15%; border: none !important; text-align: left;">
                    <img src="https://i.postimg.cc/PJwfS3KM/Jata-Malaysia-V2-svg.png" height="60">
                </td>
                <td style="text-align: center; border: none !important; vertical-align: middle;">
                    <div style="font-size: 14pt; font-weight: bold;">LAPORAN ONE PAGE REPORT (OPR)</div>
                    <div style="font-size: 14pt; font-weight: bold;">SJKC KONG MIN CAWANGAN SATU</div>
                </td>
                <td style="width: 15%; border: none !important; text-align: right;">
                    <img src="https://i.postimg.cc/fR4SQX9P/SJKC-KONG-MIN-CAWANGAN-SATU.png" height="60">
                </td>
            </tr>
        </table>

        <table>
            <tr><th>Nama Program</th><td colspan="3" id="o1" style="font-weight: bold; text-transform: uppercase;"></td></tr>
            <tr><th>Anjuran</th><td id="o2" style="width:30%"></td><th>Tarikh / Masa</th><td id="o34"></td></tr>
            <tr><th>Tempat</th><td id="o5"></td><th>Sasaran</th><td id="o6"></td></tr>
            <tr><th>Objektif</th><td colspan="3" id="o7"></td></tr>
            <tr><th>Aktiviti</th><td colspan="3" id="o8"></td></tr>
            <tr><th>Kekuatan</th><td colspan="3" id="o9"></td></tr>
            <tr><th>Kelemahan</th><td colspan="3" id="o10"></td></tr>
        </table>

        <div class="grid-gambar" id="oImg"></div>

        <div class="footer-sig">
            <div class="sig-box">
                Disediakan oleh:<br><span class="sig-line"></span>
                (<span id="o11" style="font-weight: bold; text-transform: uppercase;"></span>)
            </div>
            <div class="sig-box" style="text-align: right;">
                Disahkan oleh:<br><span class="sig-line"></span>
                (<span id="o12" style="font-weight: bold; text-transform: uppercase;"></span>)
            </div>
        </div>
    </div>
</div>

<script>
    function janaPreview() {
        // Pindahkan Teks
        for(let i=1; i<=12; i++) {
            let val = document.getElementById('in' + i) ? document.getElementById('in' + i).value : "";
            if(i === 3) {
                let m = document.getElementById('in4').value;
                document.getElementById('o34').innerText = val + " / " + m;
            } else if (i !== 4) {
                if(document.getElementById('o' + i)) document.getElementById('o' + i).innerText = val;
            }
        }

        // Papar Gambar
        const outImg = document.getElementById('oImg');
        outImg.innerHTML = '';
        const files = Array.from(document.getElementById('inImg').files).slice(0, 4);
        
        if (files.length > 0) {
            let loaded = 0;
            files.forEach(file => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    outImg.innerHTML += `<div class="img-box"><img src="${e.target.result}"></div>`;
                    loaded++;
                    if(loaded === files.length) aktifkanButang();
                };
                reader.readAsDataURL(file);
            });
        } else {
            aktifkanButang();
        }

        function aktifkanButang() {
            document.getElementById('report-preview').style.display = 'block';
            document.getElementById('btnPrint').disabled = false;
            // Scroll ke preview
            document.getElementById('report-preview').scrollIntoView({ behavior: 'smooth' });
        }
    }

    function cetakPDF() {
        window.print();
    }
</script>
</body>
</html>
