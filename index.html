<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <title>OPR SJKC KM1 - VERSI FINAL</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f4f7f6; padding: 20px; font-family: sans-serif; }
        .container { max-width: 850px; background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        
        /* Bahagian Preview - Wajib nampak gambar di sini sebelum cetak */
        #printable-area { border: 1px solid #000; padding: 15mm; margin-top: 25px; background: white; }

        @media print {
            .no-print { display: none !important; }
            body { background: white; padding: 0; }
            #printable-area { border: none; padding: 0; margin: 0; width: 100%; }
            @page { size: A4; margin: 15mm; }
            * { -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; }
        }

        table { width: 100%; border-collapse: collapse; margin-bottom: 12px; }
        th, td { border: 1px solid black !important; padding: 8px; font-size: 10pt; vertical-align: top; }
        th { background-color: #f2f2f2 !important; width: 22%; }
        
        .grid-gambar { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px; }
        .img-box { height: 180px; border: 1px solid #000; display: flex; align-items: center; justify-content: center; background: #eee; }
        .img-box img { max-height: 100%; max-width: 100%; object-fit: contain; }
    </style>
</head>
<body>

<div class="container no-print">
    <div class="alert alert-success"><strong>Data Anda Selamat:</strong> Teks yang anda taip sebelum ini akan muncul secara automatik. </div>
    <h4 class="text-center fw-bold mb-3">PENJANA OPR SJKC KM1</h4>

    <form id="oprForm">
        <div class="row g-2">
            <div class="col-12"><label class="small fw-bold">NAMA PROGRAM</label><input type="text" id="i1" class="form-control" oninput="updateAll()"></div>
            <div class="col-md-6"><label class="small fw-bold">ANJURAN</label><input type="text" id="i2" class="form-control" oninput="updateAll()"></div>
            <div class="col-md-3"><label class="small fw-bold">TARIKH</label><input type="date" id="i3" class="form-control" oninput="updateAll()"></div>
            <div class="col-md-3"><label class="small fw-bold">MASA</label><input type="text" id="i4" class="form-control" oninput="updateAll()"></div>
            <div class="col-md-6"><label class="small fw-bold">TEMPAT</label><input type="text" id="i5" class="form-control" oninput="updateAll()"></div>
            <div class="col-md-6"><label class="small fw-bold">SASARAN</label><input type="text" id="i6" class="form-control" oninput="updateAll()"></div>
            <div class="col-12"><label class="small fw-bold">OBJEKTIF</label><textarea id="i7" class="form-control" rows="2" oninput="updateAll()"></textarea></div>
            <div class="col-12"><label class="small fw-bold">AKTIVITI</label><textarea id="i8" class="form-control" rows="2" oninput="updateAll()"></textarea></div>
            <div class="col-md-6"><label class="small fw-bold">KEKUATAN</label><textarea id="i9" class="form-control" rows="2" oninput="updateAll()"></textarea></div>
            <div class="col-md-6"><label class="small fw-bold">KELEMAHAN</label><textarea id="i10" class="form-control" rows="2" oninput="updateAll()"></textarea></div>
            <div class="col-md-6"><label class="small fw-bold">DISEDIAKAN OLEH</label><input type="text" id="i11" class="form-control" oninput="updateAll()"></div>
            <div class="col-md-6"><label class="small fw-bold">DISAHKAN OLEH</label><input type="text" id="i12" class="form-control" oninput="updateAll()"></div>
            <div class="col-12"><label class="fw-bold text-primary">MASUKKAN GAMBAR (1-4)</label><input type="file" id="iImg" class="form-control border-primary" multiple accept="image/*" onchange="loadImages()"></div>
        </div>
        <button type="button" onclick="window.print()" class="btn btn-danger w-100 mt-4 fw-bold p-3">SIMPAN PDF (PASTIKAN GAMBAR DI BAWAH SUDAH MUNCUL)</button>
    </form>
</div>

<div id="printable-area">
    <div style="display:flex; justify-content:space-between; align-items:center; border-bottom:2px solid black; padding-bottom:10px; margin-bottom:15px;">
        <img src="https://i.postimg.cc/PJwfS3KM/Jata-Malaysia-V2-svg.png" width="60" onload="console.log('Logo 1 Loaded')">
        <div style="text-align:center;">
            <div style="font-weight:bold; font-size:12pt;">LAPORAN ONE PAGE REPORT (OPR) [cite: 70]</div>
            <div style="font-weight:bold; font-size:12pt;">SJKC KONG MIN CAWANGAN SATU [cite: 70]</div>
        </div>
        <img src="https://i.postimg.cc/fR4SQX9P/SJKC-KONG-MIN-CAWANGAN-SATU.png" width="60" onload="console.log('Logo 2 Loaded')">
    </div>

    <table>
        <tr><th>Program</th><td colspan="3" id="o1" style="font-weight:bold; text-transform:uppercase;"></td></tr>
        <tr><th>Anjuran</th><td id="o2"></td><th>Tarikh / Masa</th><td id="o34"></td></tr>
        <tr><th>Tempat</th><td id="o5"></td><th>Sasaran</th><td id="o6"></td></tr>
        <tr><th>Objektif</th><td colspan="3" id="o7"></td></tr>
        <tr><th>Aktiviti</th><td colspan="3" id="o8"></td></tr>
        <tr><th>Kekuatan</th><td colspan="3" id="o9"></td></tr>
        <tr><th>Kelemahan</th><td colspan="3" id="o10"></td></tr>
    </table>

    <div class="grid-gambar" id="oImg">
        <div class="img-box">Tiada Gambar</div><div class="img-box">Tiada Gambar</div>
        <div class="img-box">Tiada Gambar</div><div class="img-box">Tiada Gambar</div>
    </div>

    <div style="display:flex; justify-content:space-between; margin-top:30px;">
        <div style="width:45%">Disediakan oleh:<br><br><br>____________________<br>(<span id="o11" style="font-weight:bold;"></span>)</div>
        <div style="width:45%; text-align:right;">Disahkan oleh:<br><br><br>____________________<br>(<span id="o12" style="font-weight:bold;"></span>)</div>
    </div>
</div>

<script>
    function updateAll() {
        for(let i=1; i<=12; i++) {
            let val = document.getElementById('i'+i).value;
            localStorage.setItem('opr_save_'+i, val);
            if(i === 3) {
                document.getElementById('o34').innerText = val + " / " + document.getElementById('i4').value;
            } else if(i !== 4) {
                if(document.getElementById('o'+i)) document.getElementById('o'+i).innerText = val;
            }
        }
    }

    function loadImages() {
        const outImg = document.getElementById('oImg');
        const files = Array.from(document.getElementById('iImg').files).slice(0, 4);
        outImg.innerHTML = '';
        files.forEach(file => {
            const reader = new FileReader();
            reader.onload = (e) => {
                outImg.innerHTML += `<div class="img-box"><img src="${e.target.result}"></div>`;
            };
            reader.readAsDataURL(file);
        });
    }

    window.onload = function() {
        for(let i=1; i<=12; i++) {
            let saved = localStorage.getItem('opr_save_'+i);
            if(saved) document.getElementById('i'+i).value = saved;
        }
        updateAll();
    };
</script>
</body>
</html>
